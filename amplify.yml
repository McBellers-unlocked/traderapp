version: 1
frontend:
  phases:
    preBuild:
      commands:
        - cd sparkai
        - npm ci --legacy-peer-deps
        - mkdir -p node_modules/react-native-worklets
        - "echo 'module.exports = function() { return { visitor: {} }; };' > node_modules/react-native-worklets/plugin.js"
        - "echo '{\"name\":\"react-native-worklets\",\"main\":\"plugin.js\"}' > node_modules/react-native-worklets/package.json"
    build:
      commands:
        - cd sparkai && npm run build:web
  artifacts:
    baseDirectory: sparkai/dist
    files:
      - "**/*"
  cache:
    paths:
      - "sparkai/node_modules/**/*"
